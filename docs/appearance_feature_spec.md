# 「外観設定」機能 仕様書

## 1. 概要

このドキュメントは、Philosアプリケーションの「外観設定」機能に関する、データモデル、管理者向け画面での設定方法、および従業員向けアプリへの反映ロジックについて定義します。

この機能により、管理者（`admin`権限を持つユーザー）は、アプリケーション全体のブランドイメージ（アプリ名、ロゴ、テーマカラー）を自由にカスタマイズできます。

---

## 2. データベース設計

アプリケーション全体の外観設定は、Firestoreの単一のドキュメントに集約して管理します。

*   **コレクションパス**: `/settings`
*   **ドキュメントID**: `branding` （固定）
*   **データモデル (`BrandingSettings`)**:

    ```typescript
    {
      "appName": string;      // アプリケーション名 (例: "Philos")
      "logoIcon": string;     // 表示するLucideアイコンの名前 (例: "Building2")
      "primaryColor": string; // HSL形式のテーマカラー (例: "142.1 76.2% 36.3%")
    }
    ```

*   **セキュリティルール**:
    *   このドキュメントは、**全てのユーザーが読み取り可能**である必要があります。
    *   書き込み（作成・更新）は、**管理者（`admin`）権限を持つユーザーのみ**に制限されます。

---

## 3. 管理者向け画面 (`/dashboard/appearance`)

### 3.1. 機能要件

*   **アクセス制御**: `appearance_management`権限を持つユーザーのみがこのページにアクセスできます（デフォルトでは`admin`ロールのみ）。
*   **設定項目**:
    1.  **アプリケーション名**: テキスト入力フィールドで変更可能。
    2.  **ロゴアイコン**: アイコンピッカーを使用して、Lucideアイコンライブラリから好きなアイコンを選択可能。
    3.  **テーマカラー**: カラーピッカーとHEXコード入力フィールドを設置。直感的に色を選択・変更でき、その結果がリアルタイムでプレビュー表示される。
*   **保存処理**:
    *   「保存」ボタンをクリックすると、入力された内容が`/settings/branding`ドキュメントに保存されます。
    *   カラーピッカーで選択されたHEXコードは、保存時に自動的にHSL形式に変換されます。

---

## 4. 従業員向けアプリへの反映ロジック

従業員向けアプリは、管理者によって設定されたブランディング情報を動的に読み込み、表示に反映させます。

### 4.1. データ取得

*   アプリケーションの起動時（例: `FirebaseClientProvider`やルートレイアウト）、`/settings/branding`ドキュメントのデータをリアルタイムで購読します。
*   このデータは、React Context API（`BrandingProvider`）などを通じて、アプリ内の全てのコンポーネントで利用できるようにします。

### 4.2. 表示の動的変更

1.  **アプリ名とロゴ**:
    *   ヘッダーやサイドバーなど、アプリ名やロゴが表示される全ての箇所で、ハードコードされたテキストやアイコン名の代わりに、`BrandingProvider`から提供される`appName`と`logoIcon`の値を参照します。

2.  **テーマカラー**:
    *   アプリケーションのルートコンポーネント（`layout.tsx`など）で、`BrandingProvider`から取得した`primaryColor`（HSL形式の文字列）を取得します。
    *   取得した値を、JavaScriptを用いてCSSのルート変数`--primary`に設定します。

    ```javascript
    // 例: BrandingProvider内での実装イメージ
    useEffect(() => {
      const color = settings.primaryColor; // "142.1 76.2% 36.3%"
      document.documentElement.style.setProperty('--primary', color);
    }, [settings.primaryColor]);
    ```
    *   アプリケーションのCSS（`globals.css`）では、ボタンやアイコンなどの色は`hsl(var(--primary))`のように定義されているため、このCSS変数を書き換えるだけで、アプリ全体のテーマカラーが一斉に変更されます。

この設計により、管理者によるブランディング設定が、データベースの更新をトリガーとして、すべてのユーザーの画面にリアルタイムで反映される仕組みを実現します。
