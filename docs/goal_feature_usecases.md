# 「会社単位の目標設定」機能 ユースケース

このドキュメントは、「会社単位の目標設定」機能を利用する際の具体的な登場人物（アクター）と、その操作シナリオ（ユースケース）を定義します。

---

## 1. 登場人物（アクター）

*   **経営層ユーザー (Executive)**
    *   **役割**: 会社全体の目標を設定・管理する責任者。
    *   **権限**: 自身が所属する会社の目標に対して、新規作成、閲覧、編集、削除、表示対象設定のすべての操作が可能。

*   **一般従業員 (Employee)**
    *   **役割**: 設定された会社の目標を閲覧するユーザー。
    *   **権限**: 閲覧のみ可能。

---

## 2. ユースケース一覧

### UC-01: 新しい会社目標を設定する

*   **アクター**: 経営層ユーザー
*   **事前条件**:
    1.  ユーザーは管理者画面にログインしている。
    2.  ユーザーは「経営層 (`executive`)」ロールを持っている。
*   **成功シナリオ**:
    1.  ユーザーは「目標設定」画面 (`/dashboard/dashboard`) を開く。
    2.  「会社単位」タブが選択されていることを確認する。
    3.  「新規ウィジェット追加」ボタンをクリックする。
    4.  表示されたダイアログで、以下の情報を入力する。
        *   ウィジェットタイトル (例: "2025年度 通期売上目標")
        *   対象年度 (例: 2025)
        *   KPI項目 (例: "売上高")
        *   グラフの種類 (例: "複合グラフ")
    5.  「保存」ボタンをクリックする。
    6.  システムは、入力された情報と、ユーザーの所属会社情報を紐づけて、新しい目標データをFirestoreの `goals` コレクションに保存する (`scope: 'company'`)。
    7.  画面に新しい目標ウィジェットが追加され、「保存しました」という成功メッセージが表示される。
*   **例外シナリオ**:
    *   必須項目が未入力の場合、エラーメッセージを表示し保存させない。

### UC-02: 会社目標の月次データを編集する

*   **アクター**: 経営層ユーザー
*   **事前条件**:
    1.  ユースケースUC-01が完了しており、KPIが「売上高」の目標ウィジェットが存在する。
*   **成功シナリオ**:
    1.  ユーザーは「目標設定」画面で、編集したい「売上高」目標ウィジェットのメニューから「データ編集」を選択する。
    2.  対象年度の月次データ（目標・実績）を入力するダイアログが表示される。
    3.  ユーザーは各月の「売上目標」と「売上実績」の数値を入力・更新する。
    4.  「一括保存」ボタンをクリックする。
    5.  システムは、入力されたデータを`salesRecords`（またはそれに準ずるデータストア）に保存/更新する。
    6.  ウィジェットのプレビューグラフが更新され、「データを保存しました」という成功メッセージが表示される。

### UC-03: 従業員向けアプリに表示する目標を切り替える

*   **アクター**: 経営層ユーザー
*   **事前条件**:
    1.  複数の会社目標ウィジェットが作成されている。
*   **成功シナリオ**:
    1.  ユーザーは「目標設定」画面で、従業員向けアプリに表示させたいウィジェットのメニューから「アプリで表示」を選択する（または星マークをクリックする）。
    2.  システムは、選択されたウィジェットの `status` を `'active'` に更新する。
    3.  同時に、同じ会社単位カテゴリ内の他のすべてのウィジェットの `status` を `'inactive'` に更新する。
    4.  選択されたウィジェットに星マークが付き、表示対象であることが示される。
*   **補足**: これにより、従業員向けアプリでは常に1つの会社目標のみが表示される状態が保証される。

### UC-04: 既存の会社目標を編集・削除する

*   **アクター**: 経営層ユーザー
*   **成功シナリオ (編集)**:
    1.  ユーザーは編集したいウィジェットのメニューから「編集」を選択する。
    2.  UC-01と同様のダイアログが表示され、タイトルやKPIなどを変更して保存する。
*   **成功シナリオ (削除)**:
    1.  ユーザーは削除したいウィジェットのメニューから「削除」を選択する。
    2.  「本当に削除しますか？」という確認ダイアログが表示される。
    3.  ユーザーが「削除」を確定すると、対象の目標データが `goals` コレクションから削除される。
    4.  画面上のウィジェットが消え、「削除しました」というメッセージが表示される。

### UC-05: 会社目標を閲覧する

*   **アクター**: 一般従業員
*   **事前条件**:
    1.  経営層によって、表示対象となる会社目標 (`status: 'active'`) が1つ以上設定されている。
*   **成功シナリオ**:
    1.  従業員は従業員向けアプリのダッシュボード画面を開く。
    2.  画面の「会社目標」セクションに、`status` が `'active'` に設定されている目標のグラフ（またはカード）が表示される。
    3.  ユーザーは、会社全体の目標と現在の達成状況を視覚的に把握する。
